<?xml version="1.0" encoding="utf-8" ?>
<UserControl
    x:Class="Oxygen.Editor.World.SceneEditor.SceneEditorView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Oxygen.Editor.LevelEditor"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dnc="using:DroidNet.Controls"
    xmlns:editors="using:Oxygen.Editor.World.Documents"
    xmlns:local="using:Oxygen.Editor.World.SceneEditor"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:menus="using:DroidNet.Controls.Menus"
    xmlns:seg="using:CommunityToolkit.WinUI.Controls"
    x:Name="Root"
    mc:Ignorable="d">

    <UserControl.Resources>
        <local:LoggingVerbositySegmentIndexConverter x:Key="VerbosityIndexConverter" />
        <local:IntFloatConverter x:Key="IntFloatConverter" />
    </UserControl.Resources>

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <!--  Top app bar  -->
            <RowDefinition Height="Auto" />
            <!--  Editor area  -->
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Top app bar refactored to use ToolBar controls  -->
        <dnc:ToolBar
            Grid.Row="0"
            Margin="4,4,4,0"
            Padding="6"
            VerticalAlignment="Top">
            <!--  Primary toolbar items  -->
            <dnc:ToolBarButton
                x:Name="SaveButton"
                Command="{x:Bind ViewModel.SaveCommand}"
                Label="Save"
                ToolBarLabelPosition="Collapsed">
                <dnc:ToolBarButton.Icon>
                    <FontIconSource Glyph="&#xE105;" />
                </dnc:ToolBarButton.Icon>
                <dnc:ToolBarButton.KeyboardAccelerators>
                    <KeyboardAccelerator Key="S" Modifiers="Control" />
                </dnc:ToolBarButton.KeyboardAccelerators>
            </dnc:ToolBarButton>

            <dnc:ToolBarButton
                Command="{x:Bind ViewModel.LocateInContentBrowserCommand}"
                Label="Locate"
                ToolBarLabelPosition="Collapsed">
                <dnc:ToolBarButton.Icon>
                    <FontIconSource Glyph="&#xE8B7;" />
                </dnc:ToolBarButton.Icon>
            </dnc:ToolBarButton>

            <dnc:ToolBarSeparator />

            <dnc:ToolBarElementHost>
                <menus:MenuButton Chrome="Transparent" MenuSource="{x:Bind ViewModel.QuickAddMenu, Mode=OneWay}">
                    <menus:MenuButton.Content>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE710;" />
                    </menus:MenuButton.Content>
                </menus:MenuButton>
            </dnc:ToolBarElementHost>

            <!--  Spacer for center content (if needed)  -->
            <dnc:ToolBarElementHost>
                <StackPanel
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Orientation="Horizontal" />
            </dnc:ToolBarElementHost>

            <!--  Secondary toolbar items  -->
            <dnc:ToolBar.SecondaryItems>
                <dnc:ToolBarButton
                    x:Name="SettingsButton"
                    Label="Settings"
                    ToolBarLabelPosition="Collapsed">
                    <dnc:ToolBarButton.Icon>
                        <FontIconSource Glyph="&#xE713;" />
                    </dnc:ToolBarButton.Icon>
                    <dnc:ToolBarButton.Flyout>
                        <Flyout Placement="Bottom">
                            <StackPanel Width="260" Padding="12">
                                <TextBlock Margin="0,0,0,8" Text="Run at FPS:" />
                                <StackPanel
                                    VerticalAlignment="Center"
                                    Orientation="Horizontal"
                                    Spacing="12">
                                    <Slider
                                        Width="160"
                                        LargeChange="5"
                                        Maximum="60"
                                        Minimum="1"
                                        SmallChange="1"
                                        Value="{x:Bind ViewModel.RunAtFps, Mode=TwoWay}" />
                                    <TextBlock VerticalAlignment="Center" Text="{x:Bind ViewModel.RunAtFps, Mode=OneWay}" />
                                </StackPanel>
                                <TextBlock Margin="0,10,0,8" Text="Native engine log verbosity:" />
                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="64" />
                                    </Grid.ColumnDefinitions>
                                    <seg:Segmented
                                        x:Name="LogVerbositySegmented"
                                        HorizontalAlignment="Left"
                                        SelectedIndex="{x:Bind ViewModel.LoggingVerbosity, Mode=TwoWay, Converter={StaticResource VerbosityIndexConverter}}"
                                        SelectionMode="Single">
                                        <seg:SegmentedItem Content="E" ToolTipService.ToolTip="Error (ERR)" />
                                        <seg:SegmentedItem Content="W" ToolTipService.ToolTip="Warning (WARN)" />
                                        <seg:SegmentedItem Content="I" ToolTipService.ToolTip="Information (INF)" />
                                        <seg:SegmentedItem Content="V" ToolTipService.ToolTip="Verbose" />
                                    </seg:Segmented>
                                    <dnc:NumberBox
                                        Grid.Column="1"
                                        HorizontalAlignment="Stretch"
                                        HorizontalValueAlignment="Right"
                                        Mask="#.#"
                                        Multiplier="1"
                                        NumberValue="{x:Bind ViewModel.LoggingVerbosity, Mode=TwoWay, Converter={StaticResource IntFloatConverter}}"
                                        WithPadding="False" />
                                </Grid>
                            </StackPanel>
                        </Flyout>
                    </dnc:ToolBarButton.Flyout>
                </dnc:ToolBarButton>
            </dnc:ToolBar.SecondaryItems>
        </dnc:ToolBar>

        <!--  Viewports will be added here dynamically inside the viewport grid  -->
        <Grid
            x:Name="ViewportGrid"
            Grid.Row="1"
            ColumnSpacing="5"
            RowSpacing="5" />
    </Grid>
</UserControl>
