<?xml version="1.0" encoding="utf-8" ?>
<UserControl
    x:Class="Oxygen.Editor.WorldEditor.Inspector.SceneNodeDetailsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:anim="using:Microsoft.UI.Xaml.Media.Animation"
    xmlns:controls="using:DroidNet.Controls"
    xmlns:ctkcvt="using:CommunityToolkit.WinUI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Oxygen.Editor.WorldEditor.Inspector"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:menus="using:DroidNet.Controls.Menus"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    mc:Ignorable="d">

    <UserControl.Resources>
        <ResourceDictionary>
            <local:ItemsTypeToIconConverter x:Key="ItemsTypeToIconConverter" />

            <!--
                DynamicTree-style icon rendering:
                Use a Thumbnail + template selector so each component can use any icon UI
                (FontIcon, PathIcon, Image, etc.) without IconSourceElement.
            -->
            <local:ComponentToGlyphConverter x:Key="ComponentToGlyphConverter" />

            <DataTemplate x:Key="DefaultComponentIconTemplate">
                <FontIcon Glyph="{Binding Converter={StaticResource ComponentToGlyphConverter}}" />
            </DataTemplate>
            <DataTemplate x:Key="TransformComponentIconTemplate">
                <FontIcon Glyph="{Binding Converter={StaticResource ComponentToGlyphConverter}}" />
            </DataTemplate>
            <DataTemplate x:Key="GeometryComponentIconTemplate">
                <FontIcon Glyph="{Binding Converter={StaticResource ComponentToGlyphConverter}}" />
            </DataTemplate>
            <DataTemplate x:Key="CameraComponentIconTemplate">
                <FontIcon Glyph="{Binding Converter={StaticResource ComponentToGlyphConverter}}" />
            </DataTemplate>

            <local:ComponentIconTemplateSelector
                x:Key="ComponentIconTemplateSelector"
                CameraTemplate="{StaticResource CameraComponentIconTemplate}"
                DefaultTemplate="{StaticResource DefaultComponentIconTemplate}"
                GeometryTemplate="{StaticResource GeometryComponentIconTemplate}"
                TransformTemplate="{StaticResource TransformComponentIconTemplate}" />
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid HorizontalAlignment="Stretch">
        <Grid.RowDefinitions>
            <RowDefinition Height="44" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" MinWidth="100" />
        </Grid.ColumnDefinitions>

        <ContentPresenter
            Grid.Row="0"
            Margin="0,0,8,0"
            VerticalAlignment="Center"
            Content="{x:Bind ViewModel.NodeType, Mode=OneWay, Converter={StaticResource ItemsTypeToIconConverter}}" />

        <controls:InPlaceEditableLabel
            Grid.Row="0"
            Grid.Column="1"
            Text="{x:Bind ViewModel.Name, Mode=TwoWay}">
            <TextBlock Style="{ThemeResource BodyTextBlockStyle}" TextWrapping="NoWrap" />
        </controls:InPlaceEditableLabel>

        <StackPanel
            Grid.Row="0"
            Grid.Column="2"
            Margin="20,0,0,0"
            HorizontalAlignment="Right"
            VerticalAlignment="Center"
            Orientation="Horizontal"
            Spacing="8">
            <menus:MenuButton Content="Add" MenuSource="{x:Bind ViewModel.AddComponentMenu, Mode=OneWay}" />
            <Button
                Padding="6,2"
                Command="{x:Bind ViewModel.DeleteComponentCommand}"
                CommandParameter="{x:Bind ComponentsItemsView.SelectedItem, Mode=OneWay}">
                <FontIcon FontSize="12" Glyph="&#xE74D;" />
            </Button>
        </StackPanel>

        <muxc:ItemsView
            x:Name="ComponentsItemsView"
            Grid.Row="1"
            Grid.ColumnSpan="3"
            Margin="4,4,4,4"
            ItemsSource="{x:Bind ViewModel.Components, Mode=OneWay}"
            PreviewKeyDown="OnComponentsListView_PreviewKeyDown"
            SelectionChanged="OnComponentsItemsView_SelectionChanged"
            SelectionMode="Single">
            <muxc:ItemsView.ItemTemplate>
                <DataTemplate>
                    <muxc:ItemContainer>
                        <!--  Apply transitions on the item container element so add/delete/reorder animations run  -->
                        <UIElement.Transitions>
                            <anim:TransitionCollection>
                                <anim:AddDeleteThemeTransition />
                                <anim:ReorderThemeTransition />
                            </anim:TransitionCollection>
                        </UIElement.Transitions>

                        <StackPanel
                            Padding="4,2"
                            Orientation="Horizontal"
                            Spacing="8">
                            <Viewbox
                                Width="16"
                                Height="16"
                                VerticalAlignment="Center">
                                <controls:Thumbnail Content="{Binding}" ContentTemplateSelector="{StaticResource ComponentIconTemplateSelector}" />
                            </Viewbox>

                            <controls:InPlaceEditableLabel Text="{Binding Name, Mode=TwoWay}">
                                <TextBlock Style="{ThemeResource BodyTextBlockStyle}" TextWrapping="NoWrap" />
                            </controls:InPlaceEditableLabel>
                        </StackPanel>
                    </muxc:ItemContainer>
                </DataTemplate>
            </muxc:ItemsView.ItemTemplate>
        </muxc:ItemsView>
    </Grid>
</UserControl>
