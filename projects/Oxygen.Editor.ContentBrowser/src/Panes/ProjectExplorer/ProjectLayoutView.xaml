<?xml version="1.0" encoding="utf-8" ?>
<UserControl
    x:Class="Oxygen.Editor.ContentBrowser.ProjectExplorer.ProjectLayoutView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dnc="using:DroidNet.Controls"
    xmlns:local="using:Oxygen.Editor.ContentBrowser.ProjectExplorer"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    DataContext="{x:Bind ViewModel}"
    mc:Ignorable="d">

    <UserControl.Resources>
        <ResourceDictionary>
            <!--  Theme-aware brush for folder assets/icons  -->
            <ResourceDictionary.ThemeDictionaries>
                <ResourceDictionary x:Key="Default">
                    <SolidColorBrush x:Key="FolderAssetBrush" Color="#FFE6B800" />
                </ResourceDictionary>
                <ResourceDictionary x:Key="Light">
                    <SolidColorBrush x:Key="FolderAssetBrush" Color="#FFE6B800" />
                </ResourceDictionary>
                <ResourceDictionary x:Key="Dark">
                    <SolidColorBrush x:Key="FolderAssetBrush" Color="#FFE6B800" />
                </ResourceDictionary>
                <ResourceDictionary x:Key="HighContrast">
                    <SolidColorBrush x:Key="FolderAssetBrush" Color="{ThemeResource SystemAccentColor}" />
                </ResourceDictionary>
            </ResourceDictionary.ThemeDictionaries>

            <!--  Templates and template selector for Folder  -->
            <DataTemplate x:Key="FolderThumbnailTemplate" x:DataType="local:FolderTreeItemAdapter">
                <FontIcon Foreground="{ThemeResource FolderAssetBrush}" Glyph="{x:Bind Path=IconGlyph, Mode=OneWay}" />
            </DataTemplate>

            <DataTemplate x:Key="ProjectRootThumbnailTemplate" x:DataType="local:ProjectRootTreeItemAdapter">
                <FontIcon Foreground="{ThemeResource FolderAssetBrush}" Glyph="{x:Bind Path=IconGlyph, Mode=OneWay}" />
            </DataTemplate>

            <DataTemplate x:Key="AuthoringMountThumbnailTemplate" x:DataType="local:AuthoringMountPointTreeItemAdapter">
                <FontIcon Foreground="{ThemeResource FolderAssetBrush}" Glyph="{x:Bind Path=IconGlyph, Mode=OneWay}" />
            </DataTemplate>

            <DataTemplate x:Key="VirtualFolderMountThumbnailTemplate" x:DataType="local:VirtualFolderMountTreeItemAdapter">
                <FontIcon Foreground="{ThemeResource FolderAssetBrush}" Glyph="{x:Bind Path=IconGlyph, Mode=OneWay}" />
            </DataTemplate>

            <local:ThumbnailTemplateSelector
                x:Key="ThumbnailTemplateSelector"
                AuthoringMountTemplate="{StaticResource AuthoringMountThumbnailTemplate}"
                DefaultTemplate="{StaticResource FolderThumbnailTemplate}"
                FolderTemplate="{StaticResource FolderThumbnailTemplate}"
                ProjectRootTemplate="{StaticResource ProjectRootThumbnailTemplate}"
                VirtualFolderMountTemplate="{StaticResource VirtualFolderMountThumbnailTemplate}" />
            <!--  ~+~  -->

        </ResourceDictionary>
    </UserControl.Resources>

    <Border Margin="4,0,0,4" Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <dnc:DynamicTree
                x:Name="ProjectTree"
                Grid.Row="0"
                ThumbnailTemplateSelector="{StaticResource ThumbnailTemplateSelector}"
                ViewModel="{x:Bind ViewModel}" />

            <dnc:ToolBar
                Grid.Row="1"
                DefaultLabelPosition="Right"
                OverflowButtonVisibility="Collapsed">
                <dnc:ToolBar.PrimaryItems>
                    <dnc:ToolBarElementHost>
                        <TextBlock VerticalAlignment="Center" Text="Virtual folders" />
                    </dnc:ToolBarElementHost>
                </dnc:ToolBar.PrimaryItems>

                <dnc:ToolBar.SecondaryItems>
                    <dnc:ToolBarButton Label="Mount" ToolBarLabelPosition="Collapsed">
                        <dnc:ToolBarButton.Icon>
                            <FontIconSource FontFamily="Segoe MDL2 Assets" Glyph="&#xE8CE;" />
                        </dnc:ToolBarButton.Icon>
                        <dnc:ToolBarButton.Flyout>
                            <MenuFlyout>
                                <MenuFlyoutItem
                                    Command="{x:Bind ViewModel.MountKnownLocationCommand}"
                                    CommandParameter="{x:Bind local:KnownVirtualFolderMount.Cooked}"
                                    Text="Cooked" />
                                <MenuFlyoutItem
                                    Command="{x:Bind ViewModel.MountKnownLocationCommand}"
                                    CommandParameter="{x:Bind local:KnownVirtualFolderMount.Imported}"
                                    Text="Imported" />
                                <MenuFlyoutItem
                                    Command="{x:Bind ViewModel.MountKnownLocationCommand}"
                                    CommandParameter="{x:Bind local:KnownVirtualFolderMount.Build}"
                                    Text="Build" />
                                <MenuFlyoutSeparator />
                                <MenuFlyoutItem Command="{x:Bind ViewModel.MountLocalFolderCommand}" Text="Local Folder" />
                            </MenuFlyout>
                        </dnc:ToolBarButton.Flyout>
                    </dnc:ToolBarButton>

                    <dnc:ToolBarButton
                        Command="{x:Bind ViewModel.UnmountSelectedItemCommand}"
                        IsEnabled="{x:Bind ViewModel.CanUnmountSelectedItem, Mode=OneWay}"
                        Label="Unmount"
                        ToolBarLabelPosition="Collapsed">
                        <dnc:ToolBarButton.Icon>
                            <FontIconSource FontFamily="Segoe MDL2 Assets" Glyph="&#xE8CD;" />
                        </dnc:ToolBarButton.Icon>
                    </dnc:ToolBarButton>

                    <dnc:ToolBarSeparator />

                    <dnc:ToolBarButton
                        Command="{x:Bind ViewModel.RenameSelectedItemCommand}"
                        IsEnabled="{x:Bind ViewModel.CanRenameSelectedItem, Mode=OneWay}"
                        Label="Rename"
                        ToolBarLabelPosition="Collapsed">
                        <dnc:ToolBarButton.Icon>
                            <FontIconSource FontFamily="Segoe MDL2 Assets" Glyph="&#xE8AC;" />
                        </dnc:ToolBarButton.Icon>
                    </dnc:ToolBarButton>

                    <dnc:ToolBarSeparator />

                    <dnc:ToolBarButton
                        Command="{x:Bind ViewModel.SaveProjectMountsCommand}"
                        IsEnabled="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay}"
                        Label="Save"
                        ToolBarLabelPosition="Collapsed">
                        <dnc:ToolBarButton.Icon>
                            <FontIconSource FontFamily="Segoe MDL2 Assets" Glyph="&#xE74E;" />
                        </dnc:ToolBarButton.Icon>
                    </dnc:ToolBarButton>
                </dnc:ToolBar.SecondaryItems>
            </dnc:ToolBar>
        </Grid>
    </Border>
</UserControl>
